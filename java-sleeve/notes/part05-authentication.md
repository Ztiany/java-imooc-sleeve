# part05-authentication

## 1 令牌与权限

权限：在 C 端，控制在是否能访问 API。

权限角色划分：

1. 分组
2. 用户

一般不让用户直接与权限产生关联，而是强制用户属于某一个分组，让分组与权限产生关联。

### 动态权限

1. 组织架构。
2. 跨级回收。

这个需要根据实际情况来设计测试。

### ScopeLevel 权限设计

引入 ScopeLevel 概念，以此来桥接用户与权限管理。

### 微信小程序登录

1. 通过微信 API 静默登录。
2. 票据：使用令牌，比如 JWT。
3. 为了提高安全性，可以往 JWT 中写入一些信息，比如用户 Id，比如用户常用的 IP 地址，这样即使令牌被盗用，也能保证安全。
4. 无感知二次登录：因为令牌具有时效性。双令牌机制：access-token 与 refresh-token。【小程序有 API 可以自动登录，没有此问题】。

>JSON Web Token（缩写 JWT）是目前最流行的跨域认证解决方案。

### 微信的 openid, unionid

- openid：针对单个小程序唯一。
- unionid：针对用户唯一。

### 拦截

方式：

1. filter
2. interceptor
3. aop

## 2 超权问题

1. 所有的用户相关的接口都不应该显式地传递用户 id，因为调用段可以随意篡改用户 id，以获取其他用户的信息。
2. 需要拿到用户 id 的接口，应该要求客户端传递 jwt token，然后从 token 中获取 用户 id。
